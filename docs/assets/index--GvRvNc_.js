import{p as A,s as D}from"./element-plus-BFcDWg1f.js";import{r as v,I as U,h as z,o as F,c as G,a as g,M as c,Q as w,_ as C,$ as P,T as Q,U as y}from"./@vue-MCHm96jj.js";import"./lodash-es-Rc7wuZoG.js";import"./async-validator-DKvM95Vc.js";import"./@vueuse-BBkpAsxl.js";import"./@element-plus-BwAoTnwU.js";import"./@ctrl-r5W6hzzQ.js";import"./@popperjs-D9SI2xQl.js";import"./normalize-wheel-es-B6fDCfyv.js";const j={class:"whiteboard-box"},q={class:"whiteboard-btns"},J={class:"whiteboard"},re={__name:"index",setup(K){const u=v(),i=v(),s=v(),o=v(),t=U({drawType:"paint",lineWidth:1.5,color:"#ff0000",eraserWidth:20});function h(e){t.drawType=e}const Y=v(["#ff0000","#0000ff"]);function X(){s.value=u.value.getContext("2d"),o.value=i.value.getContext("2d");let e=u.value.parentNode.clientWidth,a=u.value.parentNode.clientHeight,l=window.devicePixelRatio||1;u.value.width=Math.round(e*l),u.value.height=Math.round(a*l),u.value.style.width=e+"px",u.value.style.height=a+"px",i.value.width=Math.round(e*l),i.value.height=Math.round(a*l),i.value.style.width=e+"px",i.value.style.height=a+"px",s.value.scale(l,l),o.value.scale(l,l)}z(()=>{X()});const d=v(0),p=v(0),k=v(0),x=v(0),m=v(!1),T=v(!1),b=v();function W(e){t.drawType!="text"?(m.value=!0,d.value=e.offsetX,p.value=e.offsetY):T.value||(T.value=!0,d.value=e.offsetX,p.value=e.offsetY,k.value=e.pageX,x.value=e.pageY,setTimeout(()=>{b.value.focus()},20))}function _(e){m.value&&(t.drawType=="paint"?(I(d.value,p.value,e.offsetX,e.offsetY),d.value=e.offsetX,p.value=e.offsetY):t.drawType=="eraser"?s.value.clearRect(e.offsetX-.5*t.eraserWidth,e.offsetY-.5*t.eraserWidth,t.eraserWidth,t.eraserWidth):t.drawType=="rect"?S(d.value,p.value,e.offsetX-d.value,e.offsetY-p.value):t.drawType=="ellipse"?R(d.value,p.value,e.offsetX,e.offsetY):t.drawType=="arrow"&&$(d.value,p.value,e.offsetX,e.offsetY))}function M(){m.value&&(["rect","ellipse","arrow"].includes(t.drawType)&&B(),m.value=!1)}function I(e,a,l,r){s.value.beginPath(),s.value.moveTo(e,a),s.value.lineTo(l,r),s.value.lineWidth=t.lineWidth,s.value.strokeStyle=t.color,s.value.stroke()}function S(e,a,l,r){o.value.clearRect(0,0,i.value.width,i.value.height),o.value.beginPath(),o.value.lineWidth=t.lineWidth,o.value.strokeStyle=t.color,o.value.rect(e,a,l,r),o.value.stroke()}function R(e,a,l,r){o.value.clearRect(0,0,i.value.width,i.value.height),o.value.beginPath(),o.value.lineWidth=t.lineWidth,o.value.strokeStyle=t.color,o.value.ellipse(e+Math.abs(l-e)/2,a+Math.abs(r-a)/2,Math.abs(l-e),Math.abs(r-a),0,0,Math.PI*2,!1),o.value.stroke()}function $(e,a,l,r){o.value.clearRect(0,0,i.value.width,i.value.height),o.value.beginPath(),o.value.moveTo(e,a),o.value.lineTo(l,r),o.value.lineWidth=t.lineWidth,o.value.strokeStyle=t.color,o.value.stroke();let n=Math.atan2(r-a,l-e),f=parseInt(t.lineWidth*7,10),N=l+.5*f*Math.cos(n),V=r+.5*f*Math.sin(n);o.value.beginPath(),o.value.moveTo(N,V),o.value.lineTo(l-f*Math.cos(n-Math.PI/6),r-f*Math.sin(n-Math.PI/6)),o.value.lineTo(l-f*Math.cos(n+Math.PI/6),r-f*Math.sin(n+Math.PI/6)),o.value.closePath(),o.value.fillStyle=t.color,o.value.fill()}function B(){let e=parseInt(u.value.style.width,10),a=parseInt(u.value.style.height,10);s.value.drawImage(i.value,0,0,i.value.width,i.value.height,0,0,e,a),o.value.clearRect(0,0,i.value.width,i.value.height)}function E(e){e.target.innerText.split(/\n\r|\n/).forEach((l,r)=>{s.value.fillStyle=t.color,s.value.font='14px "Helvetica Neue", Helvetica, "PingFang SC", "Hiragino Sans GB", "Microsoft YaHei", "微软雅黑", Arial, sans-serif';let n=d.value+9,f=p.value-14+(r+1)*20;s.value.fillText(l,n,f)}),e.target.innerText="",T.value=!1}function H(){s.value.clearRect(0,0,u.value.width,u.value.height),t.drawType=="eraser"&&h("paint")}return(e,a)=>{const l=A,r=D;return F(),G("div",j,[g("div",q,[c(l,{type:t.drawType=="paint"?"primary":"",onClick:a[0]||(a[0]=n=>h("paint"))},{default:w(()=>[y(" 画笔 ")]),_:1},8,["type"]),c(l,{type:t.drawType=="rect"?"primary":"",onClick:a[1]||(a[1]=n=>h("rect"))},{default:w(()=>[y(" 矩形 ")]),_:1},8,["type"]),c(l,{type:t.drawType=="ellipse"?"primary":"",onClick:a[2]||(a[2]=n=>h("ellipse"))},{default:w(()=>[y(" 椭圆 ")]),_:1},8,["type"]),c(l,{type:t.drawType=="arrow"?"primary":"",onClick:a[3]||(a[3]=n=>h("arrow"))},{default:w(()=>[y(" 箭头 ")]),_:1},8,["type"]),c(l,{type:t.drawType=="text"?"primary":"",onClick:a[4]||(a[4]=n=>h("text"))},{default:w(()=>[y(" 文本 ")]),_:1},8,["type"]),c(r,{modelValue:t.color,"onUpdate:modelValue":a[5]||(a[5]=n=>t.color=n),predefine:Y.value},null,8,["modelValue","predefine"]),c(l,{type:t.drawType=="eraser"?"primary":"",onClick:a[6]||(a[6]=n=>h("eraser"))},{default:w(()=>[y(" 橡皮擦 ")]),_:1},8,["type"]),c(l,{style:{"margin-left":"36px"},type:"",onClick:H},{default:w(()=>[y("清空")]),_:1})]),g("div",J,[g("canvas",{ref_key:"canvas",ref:u,class:"whiteboard-canvas",width:"",height:"",onMousedown:W,onMousemove:_,onMouseup:M,onMouseleave:M},null,544),C(g("canvas",{ref_key:"canvasTemp",ref:i,class:"whiteboard-temp",width:"",height:"",onMousedown:W,onMousemove:_,onMouseup:M,onMouseleave:M},null,544),[[P,["rect","ellipse","arrow"].includes(t.drawType)]]),C(g("div",{ref_key:"inputRef",ref:b,class:"whiteboard-input",contenteditable:"true",style:Q({color:t.color,left:k.value+"px",top:x.value-16+"px"}),onBlur:E},null,36),[[P,t.drawType=="text"&&T.value]])])])}}};export{re as default};
