import{p as N,s as V}from"./element-plus-BFcDWg1f.js";import{r as f,I as A,h as D,o as U,c as z,a as m,M as c,Q as w,_ as W,$ as _,T as F,U as y}from"./@vue-MCHm96jj.js";import"./lodash-es-Rc7wuZoG.js";import"./async-validator-DKvM95Vc.js";import"./@vueuse-BBkpAsxl.js";import"./@element-plus-BwAoTnwU.js";import"./@ctrl-r5W6hzzQ.js";import"./@popperjs-D9SI2xQl.js";import"./normalize-wheel-es-B6fDCfyv.js";const G={class:"whiteboard-box"},Q={class:"whiteboard-btns"},j={class:"whiteboard"},oe={__name:"index",setup(q){const u=f(),i=f(),s=f(),o=f(),t=A({drawType:"paint",lineWidth:1.5,color:"#ff0000",eraserWidth:20});function h(e){t.drawType=e}const C=f(["#ff0000","#0000ff"]);function P(){s.value=u.value.getContext("2d"),o.value=i.value.getContext("2d");let e=u.value.parentNode.clientWidth,a=u.value.parentNode.clientHeight,l=window.devicePixelRatio||1;u.value.width=Math.round(e*l),u.value.height=Math.round(a*l),u.value.style.width=e+"px",u.value.style.height=a+"px",i.value.width=Math.round(e*l),i.value.height=Math.round(a*l),i.value.style.width=e+"px",i.value.style.height=a+"px",s.value.scale(l,l),o.value.scale(l,l)}D(()=>{P()});const v=f(0),d=f(0),M=f(!1),g=f(!1),k=f();function x(e){t.drawType!="text"?(M.value=!0,v.value=e.offsetX,d.value=e.offsetY):g.value||(g.value=!0,v.value=e.offsetX,d.value=e.offsetY,setTimeout(()=>{k.value.focus()},20))}function b(e){M.value&&(t.drawType=="paint"?(I(v.value,d.value,e.offsetX,e.offsetY),v.value=e.offsetX,d.value=e.offsetY):t.drawType=="eraser"?s.value.clearRect(e.offsetX-.5*t.eraserWidth,e.offsetY-.5*t.eraserWidth,t.eraserWidth,t.eraserWidth):t.drawType=="rect"?S(v.value,d.value,e.offsetX-v.value,e.offsetY-d.value):t.drawType=="ellipse"?Y(v.value,d.value,e.offsetX,e.offsetY):t.drawType=="arrow"&&R(v.value,d.value,e.offsetX,e.offsetY))}function T(){["rect","ellipse","arrow"].includes(t.drawType)&&X(),M.value=!1}function I(e,a,l,r){s.value.beginPath(),s.value.moveTo(e,a),s.value.lineTo(l,r),s.value.lineWidth=t.lineWidth,s.value.strokeStyle=t.color,s.value.stroke()}function S(e,a,l,r){o.value.clearRect(0,0,i.value.width,i.value.height),o.value.beginPath(),o.value.lineWidth=t.lineWidth,o.value.strokeStyle=t.color,o.value.rect(e,a,l,r),o.value.stroke()}function Y(e,a,l,r){o.value.clearRect(0,0,i.value.width,i.value.height),o.value.beginPath(),o.value.lineWidth=t.lineWidth,o.value.strokeStyle=t.color,o.value.ellipse(e+Math.abs(l-e)/2,a+Math.abs(r-a)/2,Math.abs(l-e),Math.abs(r-a),0,0,Math.PI*2,!1),o.value.stroke()}function R(e,a,l,r){o.value.clearRect(0,0,i.value.width,i.value.height),o.value.beginPath(),o.value.moveTo(e,a),o.value.lineTo(l,r),o.value.lineWidth=t.lineWidth,o.value.strokeStyle=t.color,o.value.stroke();let n=Math.atan2(r-a,l-e),p=parseInt(t.lineWidth*7,10),E=l+.5*p*Math.cos(n),H=r+.5*p*Math.sin(n);o.value.beginPath(),o.value.moveTo(E,H),o.value.lineTo(l-p*Math.cos(n-Math.PI/6),r-p*Math.sin(n-Math.PI/6)),o.value.lineTo(l-p*Math.cos(n+Math.PI/6),r-p*Math.sin(n+Math.PI/6)),o.value.closePath(),o.value.fillStyle=t.color,o.value.fill()}function X(){let e=parseInt(u.value.style.width,10),a=parseInt(u.value.style.height,10);s.value.drawImage(i.value,0,0,i.value.width,i.value.height,0,0,e,a),o.value.clearRect(0,0,i.value.width,i.value.height)}function $(e){console.log(e),e.target.innerText.split(/\n\r|\n/).forEach((l,r)=>{s.value.fillStyle=t.color,s.value.font='14px "Helvetica Neue", Helvetica, "PingFang SC", "Hiragino Sans GB", "Microsoft YaHei", "微软雅黑", Arial, sans-serif';let n=v.value+9,p=d.value-15+(r+1)*20;s.value.fillText(l,n,p)}),e.target.innerText="",g.value=!1}function B(){s.value.clearRect(0,0,u.value.width,u.value.height),t.drawType=="eraser"&&h("paint")}return(e,a)=>{const l=N,r=V;return U(),z("div",G,[m("div",Q,[c(l,{type:t.drawType=="paint"?"primary":"",onClick:a[0]||(a[0]=n=>h("paint"))},{default:w(()=>[y(" 画笔 ")]),_:1},8,["type"]),c(l,{type:t.drawType=="rect"?"primary":"",onClick:a[1]||(a[1]=n=>h("rect"))},{default:w(()=>[y(" 矩形 ")]),_:1},8,["type"]),c(l,{type:t.drawType=="ellipse"?"primary":"",onClick:a[2]||(a[2]=n=>h("ellipse"))},{default:w(()=>[y(" 椭圆 ")]),_:1},8,["type"]),c(l,{type:t.drawType=="arrow"?"primary":"",onClick:a[3]||(a[3]=n=>h("arrow"))},{default:w(()=>[y(" 箭头 ")]),_:1},8,["type"]),c(l,{type:t.drawType=="text"?"primary":"",onClick:a[4]||(a[4]=n=>h("text"))},{default:w(()=>[y(" 文本 ")]),_:1},8,["type"]),c(r,{modelValue:t.color,"onUpdate:modelValue":a[5]||(a[5]=n=>t.color=n),predefine:C.value},null,8,["modelValue","predefine"]),c(l,{type:t.drawType=="eraser"?"primary":"",onClick:a[6]||(a[6]=n=>h("eraser"))},{default:w(()=>[y(" 橡皮擦 ")]),_:1},8,["type"]),c(l,{style:{"margin-left":"36px"},type:"",onClick:B},{default:w(()=>[y("清空")]),_:1})]),m("div",j,[m("canvas",{ref_key:"canvas",ref:u,class:"whiteboard-canvas",width:"",height:"",onMousedown:x,onMousemove:b,onMouseup:T,onMouseleave:T},null,544),W(m("canvas",{ref_key:"canvasTemp",ref:i,class:"whiteboard-temp",width:"",height:"",onMousedown:x,onMousemove:b,onMouseup:T,onMouseleave:T},null,544),[[_,["rect","ellipse","arrow"].includes(t.drawType)]]),W(m("div",{ref_key:"inputRef",ref:k,class:"whiteboard-input",contenteditable:"true",style:F({color:t.color,left:v.value+"px",top:d.value-16+"px"}),onBlur:$},null,36),[[_,t.drawType=="text"&&g.value]])])])}}};export{oe as default};
