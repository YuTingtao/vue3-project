import{p as A,u as D}from"./element-plus-BEzc5NB6.js";import{n as j,r as v,a8 as q,I as z,o as F,X as g,a0 as h,_ as w,ao as y,a5 as C,a6 as P,a3 as G,q as O}from"./vendor-D-cnfIL5.js";const U={class:"whiteboard-box"},J={class:"whiteboard-btns"},K={class:"whiteboard"},L=j({name:"WhiteBoard"}),te=Object.assign(L,{setup(Q){const u=v(),i=v(),s=v(),o=v(),a=q({drawType:"paint",lineWidth:1.5,color:"#ff0000",eraserWidth:20});function c(t){a.drawType=t}const X=v(["#ff0000","#0000ff"]);function Y(){s.value=u.value.getContext("2d"),o.value=i.value.getContext("2d");let t=u.value.parentNode.clientWidth,e=u.value.parentNode.clientHeight,l=window.devicePixelRatio||1;u.value.width=Math.round(t*l),u.value.height=Math.round(e*l),u.value.style.width=t+"px",u.value.style.height=e+"px",i.value.width=Math.round(t*l),i.value.height=Math.round(e*l),i.value.style.width=t+"px",i.value.style.height=e+"px",s.value.scale(l,l),o.value.scale(l,l)}z(()=>{Y()});const d=v(0),f=v(0),k=v(0),x=v(0),T=v(!1),m=v(!1),b=v();function _(t){a.drawType!="text"?(T.value=!0,d.value=t.offsetX,f.value=t.offsetY):m.value||(m.value=!0,d.value=t.offsetX,f.value=t.offsetY,k.value=t.pageX,x.value=t.pageY,setTimeout(()=>{b.value.focus()},20))}function W(t){T.value&&(a.drawType=="paint"?(I(d.value,f.value,t.offsetX,t.offsetY),d.value=t.offsetX,f.value=t.offsetY):a.drawType=="eraser"?s.value.clearRect(t.offsetX-.5*a.eraserWidth,t.offsetY-.5*a.eraserWidth,a.eraserWidth,a.eraserWidth):a.drawType=="rect"?S(d.value,f.value,t.offsetX-d.value,t.offsetY-f.value):a.drawType=="ellipse"?R(d.value,f.value,t.offsetX,t.offsetY):a.drawType=="arrow"&&B(d.value,f.value,t.offsetX,t.offsetY))}function M(){T.value&&(["rect","ellipse","arrow"].includes(a.drawType)&&E(),T.value=!1)}function I(t,e,l,n){s.value.beginPath(),s.value.moveTo(t,e),s.value.lineTo(l,n),s.value.lineWidth=a.lineWidth,s.value.strokeStyle=a.color,s.value.stroke()}function S(t,e,l,n){o.value.clearRect(0,0,i.value.width,i.value.height),o.value.beginPath(),o.value.lineWidth=a.lineWidth,o.value.strokeStyle=a.color,o.value.rect(t,e,l,n),o.value.stroke()}function R(t,e,l,n){o.value.clearRect(0,0,i.value.width,i.value.height),o.value.beginPath(),o.value.lineWidth=a.lineWidth,o.value.strokeStyle=a.color,o.value.ellipse(t+Math.abs(l-t)/2,e+Math.abs(n-e)/2,Math.abs(l-t),Math.abs(n-e),0,0,Math.PI*2,!1),o.value.stroke()}function B(t,e,l,n){o.value.clearRect(0,0,i.value.width,i.value.height),o.value.beginPath(),o.value.moveTo(t,e),o.value.lineTo(l,n),o.value.lineWidth=a.lineWidth,o.value.strokeStyle=a.color,o.value.stroke();let r=Math.atan2(n-e,l-t),p=parseInt(a.lineWidth*7,10),V=l+.5*p*Math.cos(r),$=n+.5*p*Math.sin(r);o.value.beginPath(),o.value.moveTo(V,$),o.value.lineTo(l-p*Math.cos(r-Math.PI/6),n-p*Math.sin(r-Math.PI/6)),o.value.lineTo(l-p*Math.cos(r+Math.PI/6),n-p*Math.sin(r+Math.PI/6)),o.value.closePath(),o.value.fillStyle=a.color,o.value.fill()}function E(){let t=parseInt(u.value.style.width,10),e=parseInt(u.value.style.height,10);s.value.drawImage(i.value,0,0,i.value.width,i.value.height,0,0,t,e),o.value.clearRect(0,0,i.value.width,i.value.height)}function H(t){t.target.innerText.split(/\n\r|\n/).forEach((l,n)=>{s.value.fillStyle=a.color,s.value.font='14px "Helvetica Neue", Helvetica, "PingFang SC", "Hiragino Sans GB", "Microsoft YaHei", "微软雅黑", Arial, sans-serif';let r=d.value+9,p=f.value-14+(n+1)*20;s.value.fillText(l,r,p)}),t.target.innerText="",m.value=!1}function N(){s.value.clearRect(0,0,u.value.width,u.value.height),a.drawType=="eraser"&&c("paint")}return(t,e)=>{const l=A,n=D;return O(),F("div",U,[g("div",J,[h(l,{type:a.drawType=="paint"?"primary":"",onClick:e[0]||(e[0]=r=>c("paint"))},{default:w(()=>e[7]||(e[7]=[y(" 画笔 ")])),_:1,__:[7]},8,["type"]),h(l,{type:a.drawType=="rect"?"primary":"",onClick:e[1]||(e[1]=r=>c("rect"))},{default:w(()=>e[8]||(e[8]=[y(" 矩形 ")])),_:1,__:[8]},8,["type"]),h(l,{type:a.drawType=="ellipse"?"primary":"",onClick:e[2]||(e[2]=r=>c("ellipse"))},{default:w(()=>e[9]||(e[9]=[y(" 椭圆 ")])),_:1,__:[9]},8,["type"]),h(l,{type:a.drawType=="arrow"?"primary":"",onClick:e[3]||(e[3]=r=>c("arrow"))},{default:w(()=>e[10]||(e[10]=[y(" 箭头 ")])),_:1,__:[10]},8,["type"]),h(l,{type:a.drawType=="text"?"primary":"",onClick:e[4]||(e[4]=r=>c("text"))},{default:w(()=>e[11]||(e[11]=[y(" 文本 ")])),_:1,__:[11]},8,["type"]),h(n,{modelValue:a.color,"onUpdate:modelValue":e[5]||(e[5]=r=>a.color=r),predefine:X.value},null,8,["modelValue","predefine"]),h(l,{type:a.drawType=="eraser"?"primary":"",onClick:e[6]||(e[6]=r=>c("eraser"))},{default:w(()=>e[12]||(e[12]=[y(" 橡皮擦 ")])),_:1,__:[12]},8,["type"]),h(l,{style:{"margin-left":"36px"},type:"",onClick:N},{default:w(()=>e[13]||(e[13]=[y("清空")])),_:1,__:[13]})]),g("div",K,[g("canvas",{ref_key:"canvas",ref:u,class:"whiteboard-canvas",width:"",height:"",onMousedown:_,onMousemove:W,onMouseup:M,onMouseleave:M},null,544),C(g("canvas",{ref_key:"canvasTemp",ref:i,class:"whiteboard-temp",width:"",height:"",onMousedown:_,onMousemove:W,onMouseup:M,onMouseleave:M},null,544),[[P,["rect","ellipse","arrow"].includes(a.drawType)]]),C(g("div",{ref_key:"inputRef",ref:b,class:"whiteboard-input",contenteditable:"true",style:G({color:a.color,left:k.value+"px",top:x.value-16+"px"}),onBlur:H},null,36),[[P,a.drawType=="text"&&m.value]])])])}}});export{te as default};
